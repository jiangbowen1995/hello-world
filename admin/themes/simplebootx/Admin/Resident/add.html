<admintpl file="header" />
</head>
<body>
	<div class="wrap">
		<ul class="nav nav-tabs">
			<li ><a href="{:U('Resident/index')}">居民列表</a></li>
			<li class="active"><a href="{:U('Resident/add')}">居民添加</a></li>
			<li><a href="{:U('Resident/featuresIndex')}">全部居民类型</a></li>
			<li><a href="{:U('Resident/featuresAdd')}">添加居民类型</a></l>
			<li><a href="{:U('Resident/import')}">批量添加</a></li>
		</ul>
		<form method="post" class="form-horizontal js-ajax-form form-flat" action="{:U('Resident/add_post')}">
		<!--  -->
		<!-- -->
			<fieldset>
				<div class="control-group">
					<label class="control-label">楼号:</label>
					<div class="controls">
						<select name="building_id" id="building_id" class="js-ajax-select" data-id="unit_id" data-href="{:U('Resident/unit_json')}">
							<option value="">请选择</option>
							<foreach name="buildings" item="vo">
							<option value="{$vo.id}">{$vo.num}号楼</option>
							</foreach>
						</select>
						<span class="form-required">*</span>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">单元数:</label>
					<div class="controls">
						<select name="unit_id" id="unit_id" class="js-ajax-select" data-id="home_id" data-href="{:U('Resident/num_json')}">
							<option value="">请选择</option>
						</select>
						<span class="form-required">*</span>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">房间号:</label>
					<div class="controls">
						<select name="home_id" id="home_id">
							<option value="">请选择</option>
						</select>
						<span class="form-required">*</span>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">姓名:</label>
					<div class="controls">
						<input type="text" name="xingming">
						<span class="form-required">*</span>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">曾用名:</label>
					<div class="controls">
						<input type="text" name="cengyong">
						<span class="form-required">*</span>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">性别:</label>
					<div class="controls">
						<select name="xingbie" id = "sex">
							<option value="男">男</option>
							<option value="女">女</option>
						</select>
						<span class="form-required">*</span>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">民族:</label>
					<div class="controls">
						<input type="text" name="minzu">
						<span class="form-required">*</span>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">联系电话:</label>
					<div class="controls">
						<input type="text" name="dianhua">
						<span class="form-required">*</span>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">身份证:</label>
					<div class="controls">
						<input type="text" name="shenfenzheng" id="shenfenzheng">
						<span class="form-required" id="shenfen" style="color:red">*</span>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">出生日期:</label>
					<div class="controls">
						<input type="text" name="chusheng" class="js-date" style="width: 120px;" autocomplete="off" id="birthday">
						<span class="form-required">*</span>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">户籍:</label>
					<div class="controls">
						<input type="text" name="huji">
						<span class="form-required">*</span>
					</div>
				</div>
				
				<div class="control-group">
					<label class="control-label">常住:</label>
					<div class="controls">
						<select name="changzhu">
							
							<option value="0">常住人口</option>
							<option value="1">外省市流动人口</option>
						</select>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">人户分离入口:</label>
					<div class="controls">
						<select name="fenli">
							<option value="">请选择</option>
							<option value="人在户不在">人在户不在</option>
							<option value="户在人不在">户在人不在</option>
							<option value="本区人员">本区人员</option>
						</select>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">职业:</label>
					<div class="controls">
						<input type="text" name="zhiye">
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">处所:</label>
					<div class="controls">
						<input type="text" name="chusuo">
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">是否为房主</label>
					<div class="controls" style="margin-top: 2	px" ;>
						<input type="radio" name="fangzhu" value="0" checked="checked">&nbsp;否 &nbsp; &nbsp;
						<input type="radio" name="fangzhu" value="1" >&nbsp;是
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">车牌号码:</label>
					<div class="controls">
						<input type="text" name="chepai">
					</div>
				</div>
				<div class="clear">
					<label class="control-label">其他:</label>
					<div class="controls">
						<foreach name = "att" item="vo">
							<label class="flat-label"><input name="flag[]" type="checkbox" value="{$vo.id}">{$vo.attname}</label>
						</foreach>
						<br>
						<br>
					</div>
				</div>
			</fieldset>
			<div class="form-actions">
				<button type="submit" class="btn btn-primary js-ajax-submit" id="button">{:L('ADD')}</button>
				<a class="btn" href="javascript:history.back(-1);">{:L('BACK')}</a>
			</div>
		</form>
	</div>
	<script src="__PUBLIC__/js/common.js"></script>
	<script type="text/javascript">
		// 验证身份证 
	
		$("#shenfenzheng").blur(function(){

			var pattern = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/; 
			var name = $('#shenfenzheng').val();
			if (!pattern.test(name)) {
				$("#shenfen").html('身份证格式错误');
				$('#button').attr('disabled',"true");
			}else{
			$('#button').removeAttr("disabled");	
			var	year= name.slice(6,10);
			var month = name.slice(10,12);
			var day = name.slice(12,14);
			var sex = name.slice(16,17);
			var birthday = year+'-'+month+'-'+day;
			$("#birthday").val(birthday);
			if ( sex%2 == 0 ) {
				 $("#sex").find("option").eq(1).attr("selected","selected");
				
			} else{
				$("#sex").find("option").eq(2).attr("selected","selected");
							
			}

			
			if (name !== '') {
			var url = "{:U('Resident/ajaxResident')}";
			$.ajax({
				 type: "POST",
				 url:url,
				 data:{shenfenzheng:name},
				 // dataType: "json",
				 success: function(data){
					console.log(data);
					if ( data == 1){
						$("#shenfen").html('身份证已存在');

					}else if( data == 0){
						$("#shenfen").html('身份证可用');
					}
				 },
				 error:function(){
				 	console.log('ajax请求失败');
				 }
			});
		}else{
			$("#shenfen").html('身份证不为空');
		}
		}
		});
	</script>
</body>
</html>